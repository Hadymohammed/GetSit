@using GetSit.Data.ViewModels
@model BookingVM
<link rel="stylesheet" href="./css/booking.css"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
<div class="container">
    <div class="header">
        <div class="header-hall">
        <div class="hall-name">@Model.SelectedHall.Type.ToString()</div>
            <div>
                <span>@Model.SelectedSpace.Country,</span>
                <span>@Model.SelectedSpace.City,</span>
                <span>@Model.SelectedSpace.Street</span>
            </div>
        </div>
        <div class="header-actions">
            <i class="fa-regular fa-heart color-red"></i>
        </div>
    </div>
    <!--slider-->
    <div class="slider-container">
        <div class="slider-card">
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                <ol class="carousel-indicators">
                    @for(int i=0;i<Model.SelectedHall.HallPhotos.Count();i++)
                        {
                            @if(i==0)
                            {
                                <li data-target="#carouselExampleIndicators" data-slide-to="@i" class="active"></li>
                            }
                            else{
                                <li data-target="#carouselExampleIndicators" data-slide-to="@i"></li>
                            }
                        }
                </ol>
                <div class="carousel-inner">
                    @{
                        var j = 0;
                    }
                    @foreach (var photo in Model.SelectedHall.HallPhotos)
                    {
                        @if (j++ == 0)
                        {
                            <div class="carousel-item active">
                                <img class="d-block w-100" src="@photo.Url" alt="@j slide">
                            </div>
                        }
                        else
                        {
                            <div class="carousel-item">
                                <img class="d-block w-100" src="@photo.Url" alt="@j slide">
                            </div>
                        }
                    }
                </div>
                <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
    </div>
    <!--Main-->
    <div class="hall-booking-main">
        <!--SpaceInfo-->
        <div class="hall-booking-main-left">
            <!--Space-->
            <div class="space">
                <div class="space-image">
                    <img class="avatar-md" src="@Model.SelectedSpace.Photos.FirstOrDefault().Url"/>
                </div>
                <div class="space-details">
                    <div class="space-name">@Model.SelectedSpace.Name</div>
                    <div class="space-info">
                        <div>@Model.SelectedSpace.Name Host since @DateTime.Now.ToString("D")</div>
                    </div>
                </div>
            </div>
            <hr />
            <!--Space-bio-->
            <div class="space-bio">
                <h3 class="card-header-title">About this space</h3>
                <div class="bio">@Model.SelectedSpace.Bio</div>
            </div>
             <!-- facilities-->
                @if (Model.SelectedHall.HallFacilities.Capacity != 0)
                {
                <hr>
                    <div>
                        <h3 class="card-header-title">Hall Facilities </h3>
                        @foreach (var facility in Model.SelectedHall.HallFacilities)
                        {
                            <button class="pill-btn">&nbsp; @facility.Facility</button>
                        }
                        <br />
                    </div>
                }
            <hr />
            <!--Services-->
            <h2 class="card-header-title">Space Services </h2>
            <div class="services-contanier">
                <!-- amenities card starts -->
                @foreach (var service in Model.SelectedSpace.Services)
                {
                    <div class="product-card">
                        <div class="product-content">
                            <div class="product-photo">
                                <img src="@service.ServicePhotos.First().Url" alt="Product Photo">
                            </div>
                            <div class="product-details">
                                <h3 class="product-name">@service.Name</h3>
                                <p class="product-description">@service.Description</p>
                                <p class="product-price">Price: @service.Price.ToString("N2")</p>
                            </div>
                        </div>
                    </div>
                }

                <!-- amenities card ends -->

            </div>
            <!--Working Times-->
            <div class="Working-times">
                <h2 class="card-header-title"> Working Times </h2>
                <div class="grid-wdays">
                    @foreach (var day in Model.SelectedSpace.WorkingDays)
                    {
                        <div>
                            <p><b>@day.Day</b></p>
                            <p>
                                @{
                                    var start = new DateTime(day.OpeningTime.Ticks).ToString("hh:mm tt");
                                }
                                @start
                                -
                                @{
                                    var end = new DateTime(day.ClosingTime.Ticks).ToString("hh:mm tt");
                                }
                                @end
                            </p>
                        </div>
                    }
                </div>
            </div>
            <hr />
            <!--Schedule-->
            <h3 class="card-header-title">Booking schedule : <span>@Model.SlotsForWeek[0].Keys.First().ToString("D")</span></h3>
            <div class="schedule-container">
                <table class="schedule">
                    <thead>
                        <tr>
                            <th></th>
                            @foreach (var day in Model.SlotsForWeek)
                            {
                                <th>
                                    <div>
                                        <p>@day.Keys.First().DayOfWeek.ToString()</p>
                                        <p>@day.Keys.First().Day</p>
                                    </div>
                                </th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Generate rows for each time slot (15-minute intervals) -->
                        <!-- Example: 16 rows for a 4-hour schedule (08:00 AM to 12:00 PM) -->
                        @for (var slotIdx = 32; slotIdx < 96; slotIdx++)
                        {
                            <tr>
                                <td class="time-span-schedule">
                                    @{
                                        var span = new DateTime(Model.SlotsForWeek[0].Values.First()[slotIdx].Item1.Ticks).ToString("hh:mm tt");
                                    }
                                    <div>@span</div>
                                </td>
                                @for (var dayIdx = 0; dayIdx < 7; dayIdx++)
                                {
                                    @if (@Model.SlotsForWeek[dayIdx].Values.First()[slotIdx].Item2 == true)
                                    {
                                        <td></td>
                                    }
                                    else
                                    {
                                        <td class="booking"></td>
                                    }
                                }
                            </tr>
                        }

                    </tbody>
                </table>
            </div>
        </div>
        <!--Booking-->
        <div class="hall-booking-main-right">
            
        </div>
    </div>
    </div>
</div>

@section Scripts
    {
       <script>
        $(document).ready(function () {
            var $dropdown = $(".dropdown-menu");

            $dropdown.on("click", ".counter-btn", function (e) {
                e.preventDefault();
                var $counterContainer = $(this).closest(".counter-container");
                var $counterValue = $counterContainer.find(".counter-value");
                var currentValue = parseInt($counterValue.text()) || 0;
                var increment = $(this).hasClass("increment") ? 1 : -1;

                var newValue = currentValue + increment;
                if (newValue < 0) {
                    newValue = 0;
                }

                $counterValue.text(newValue);

                // Update the hidden input field with the selected quantity
                var $parent = $(this).closest(".edit-list-item");
                var serviceId = $parent.data("service-id");
                var $hiddenInput = $parent.find("input[type=hidden]");
                $hiddenInput.attr("name", "SelectedServices[" + serviceId + "]");

                // Prevent dropdown from closing when clicking on the counter buttons
                e.stopPropagation();
            });
        });


        $(document).on('show.bs.modal', '.modal', function () {
            $(this).appendTo('body');
        });
    </script>

}